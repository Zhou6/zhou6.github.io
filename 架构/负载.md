


nginx 是7层负载，会慢， 最多5万并发
正常的负载均衡是4层（3层半），不会握手，数据包转发级别，所以特别快，但是后部的服务器们服务必须一致

lvs：基于linux的四层负载均衡器，已经被包含进了linux内核，模块名：ipvs
lvs连接模式： 
    NAT：来回的数据必须过负载，所以缺点：带宽成为瓶颈
    TUN隧道技术：到负载之后，在数据包外面加一层负载ip=》服务器ip的皮，跳转到服务器之后，撕掉这层皮，处理真实数据包即可，（vpn的实现）
    DR（常用）： 基于2层，负载通过更换mac地址跳转到ip相同的真实服务器，负载和server在同一局域网，所以ip一致，返回数据不需要通过负载
        对外隐藏服务器ip，对内可见实现原理：
            修改两个协议：arg_inore、arg_announce
            且ip配在lo（localhost内部虚拟网卡）接口上
        
负载如何知道每个服务器现有连接数而去根据负载分配新连接：偷窥第四层的握手和挥手包，虽然服务端的包不过负载，但是客户端的包肯定会过负载，所以肯定能抓到1～2个握手挥手包
            
控制lvs的客户端：yum install ipvsadm -y


隐患：单点故障
1：lvs挂掉
2：server挂掉
解决：
  1.lvs 主备（常用）：主机绑定ip，一旦故障，ip绑定给备用机即可
  2.lvs 主主：动态dns
  


keepalived 监控服务自动化软件
1、监控自己服务
2、master机通告自己还活着、备用机监听master状态，master挂了，一堆备用机推举出新master
3、配置服务器ip，添加ipvs, keepalived有配置文件
4、对server做健康检查



