## 线程，进程，异步
- 协程：yield,同一线程下，多个子程序协作完成任务，而不需要多线程的抢占式多任务，没有线程切换的开销，不需要多线程的锁机制。。利用多核CPU的方法是多进程+协程 。虽然并没有实现异步，但是确实异步io实现的基础
- 非阻塞/异步IO:  
 	- 单线程异步：
 		- Python 3.4 - asyncio.coroutine和yield from
 		- Python 3.5 - async和await
 		- 是同一线程下完成，利用消息循环，遇到io操作不需要等待，直接执行下一个消息，等上一条io返回后继续执行。实现并发
 	- 多线程：也可以线程之外另外启动一个线程来执行阻塞的程序 
- 线程 ：
    - 所有变量都由所有线程共享，所以任何一个变量都可以被任何一个线程修改。
 	- 不会分配内存
 	- 任何一个线程挂掉都可能直接造成整个进程崩溃，因为所有线程共享进程的内存
    - 多线程模式通常比多进程快一点，但是也快不到哪去
 	- 最多（线程数 = cpu数*核数） 并行；并发的话就很多了，cpu很快
 	- cpython有gil（全局解释器锁）导致不能真正的多线程，除非遇到io操作或者超过一定时间会释放锁，所以适合IO密集型。
- 进程 ：
    - 会分配内存，所以开多了内存会不足。
 	- 子进程崩溃了，不会影响主进程和其他子进程
 	- fork, 调用一次，返回两次. 子进程永远返回0，而父进程返回子进程的ID
 	- multiprocessing，Queue
           Python的multiprocessing模块不但支持多进程，其中managers子模块还支持把多进程分布到多台机器上。一个服务进程可以作为调度者，将任务分布到其他多个进程中，依靠网络通信。由于managers模块封装很好，不必了解网络通信的细节，就可以很容易地编写分布式多进程程序
###tornado框架
- tornado的IO指的是处理网络连接的异步，实现高并发
- 原理：ioloop 的实现基于 epoll ，那么什么是 epoll？ epoll 是Linux内核为处理大批量文件描述符而作了改进的 poll 。单线程的torndo打开一个IO事件循环， 当碰到IO请求（新链接进来 或者 调用api获取数据），由于这些IO请求都是非阻塞的IO，都会把这些非阻塞的IO socket 扔到一个socket管理器，所以，这里单线程的CPU只要发起一个网络IO请求，就不用挂起线程等待IO结果，这个单线程的事件继续循环，接受其他请求或者IO操作，如此循环。
- tornado中非阻塞gen.coroutine原理: 待完善, https://www.jianshu.com/p/4430f21c431c
- 其他框架实现网络连接异步选择 gevent或者原生库asyhttp(基于asyncio,但是asyncio目前坑比较多) 。
- 网络连接异步不适合用多线程，因为连接数太大会导致线程数太多，切换线程本身也是耗资源的
- gevent：通过greenlet实现协程
    - 其基本思想是：当一个greenlet遇到IO操作时，比如访问网络，就自动切换到其他的greenlet，等到IO操作完成，再在适当的时候切换回来继续执行。由于IO操作非常耗时，经常使程序处于等待状态，有了gevent为我们自动切换协程，就保证总有greenlet在运行，而不是等待IO。
    - 需要修改Python自带的一些标准库，这一过程在启动时通过monkey patch完成
    - gevent只能在Unix/Linux下运行，在Windows下不保证正常安装和运行。
 	   

